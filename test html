<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Badge ESP</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen">

    <div class="bg-slate-800 p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-700">
        <h1 class="text-2xl font-bold mb-6 text-blue-400">Simulatore Lettore NFC</h1>
        
        <div class="space-y-4">
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Inserisci Tag ID (come farebbe l'ESP)</label>
                <input type="text" id="tagInput" placeholder="es. A3 B2 C1 00" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white outline-none focus:border-blue-500 font-mono">
            </div>
            
            <button onclick="inviaTimbrata()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all">SIMULA TIMBRATA</button>
        </div>

        <div id="result" class="mt-6 p-4 rounded-lg bg-black/30 text-xs font-mono hidden"></div>
    </div>

    <script>
        async function inviaTimbrata() {
            const tagID = document.getElementById('tagInput').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = "Invio in corso...";
            resultDiv.className = "mt-6 p-4 rounded-lg bg-yellow-900/20 text-yellow-400 text-xs font-mono border border-yellow-700/50";

            try {
                // NOTA: Se usi Vercel, l'URL sar√† '/api/timbra'. In locale potrebbe essere diverso.
                const response = await fetch('/api/timbra', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tagID: tagID })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = "mt-6 p-4 rounded-lg bg-green-900/20 text-green-400 text-xs font-mono border border-green-700/50";
                    resultDiv.innerHTML = `<strong>SUCCESSO:</strong><br>${data.message}<br>Ora: ${data.time}`;
                } else {
                    throw new Error(data.error || "Errore sconosciuto");
                }
            } catch (error) {
                resultDiv.className = "mt-6 p-4 rounded-lg bg-red-900/20 text-red-400 text-xs font-mono border border-red-700/50";
                resultDiv.innerHTML = `<strong>ERRORE:</strong><br>${error.message}`;
            }
        }
    </script>
</body>
</html>
